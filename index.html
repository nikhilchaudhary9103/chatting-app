<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tech Social media by nikhil</title>
  <style>
    :root{
      --bg:#071226; --muted:#9fb0c8; --card-bg:rgba(255,255,255,0.02);
      --accent:#06b6d4; --white:#e6eef8;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{
      background:
        radial-gradient(800px 400px at 10% 10%, rgba(3,7,18,0.7), transparent 10%),
        linear-gradient(180deg, #071022 0%, #081226 40%, #071520 100%);
      color:var(--white);
      -webkit-font-smoothing:antialiased;
      padding:22px;
    }
    .container{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
    h1{font-size:20px;margin:0}
    .sub{font-size:13px;color:var(--muted)}

    /* Search bar */
    .search-wrap{display:flex;gap:10px;align-items:center}
    .search-input{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);padding:10px 12px;border-radius:10px;color:var(--white);min-width:260px}
    .search-btn{padding:9px 12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),#7dd3fc);color:#022;cursor:pointer;font-weight:600}

    /* Feed */
    .feed{display:grid;gap:14px}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      padding:14px;border-radius:14px;
      display:grid;grid-template-columns:64px 1fr;gap:12px;align-items:start;
      box-shadow: 0 8px 26px rgba(2,6,23,0.6);
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .card:hover{transform:translateY(-6px);box-shadow:0 20px 36px rgba(2,6,23,0.7)}
    .avatar{width:64px;height:64px;border-radius:999px;overflow:hidden;border:2px solid rgba(255,255,255,0.06)}
    .avatar img{width:100%;height:100%;object-fit:cover;display:block}

    .meta{display:flex;flex-direction:column;gap:8px}
    .meta-row{display:flex;align-items:center;gap:8px;justify-content:space-between}
    .name{font-weight:700;font-size:15px}
    .handle{color:var(--muted);font-size:13px}
    .time{color:var(--muted);font-size:12px;margin-left:6px}

    .content{font-size:14px;color:#dfe8f3;line-height:1.45}
    .post-image{margin-top:10px;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
    .post-image img{width:100%;height:360px;object-fit:cover;display:block}

    .actions{display:flex;align-items:center;justify-content:space-between;margin-top:10px}
    .left-actions{display:flex;gap:14px;align-items:center;color:var(--muted);font-size:13px}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 10px;border-radius:999px;font-size:13px;color:var(--white);cursor:pointer}
    .btn.following{background:linear-gradient(90deg,var(--accent),#7dd3fc);color:#022;border:0}

    /* Wiki badge */
    .badge-wiki{background:rgba(6,182,212,0.12);color:var(--accent);padding:6px 8px;border-radius:999px;font-weight:700;font-size:12px;border:1px solid rgba(6,182,212,0.14)}

    /* Skeleton */
    .skeleton{animation: pulse 1s linear infinite;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.05), rgba(255,255,255,0.02));border-radius:8px}
    .sk-row{display:flex;gap:12px;align-items:center}
    .sk-avatar{width:64px;height:64px;border-radius:999px}
    .sk-lines{flex:1;display:flex;flex-direction:column;gap:8px}
    .sk-line{height:10px;border-radius:6px;width:100%}
    .sk-large{height:220px;border-radius:8px;margin-top:8px}

    @keyframes pulse{0%{opacity:1}50%{opacity:0.45}100%{opacity:1}}

    /* Loader / error */
    .center{display:flex;align-items:center;justify-content:center}
    .error{background:rgba(255,25,25,0.06);color:#ffd4d4;padding:10px;border-radius:8px;border:1px solid rgba(255,25,25,0.06)}

    /* Responsive */
    @media (max-width:700px){
      .post-image img{height:210px}
      body{padding:14px}
      header{flex-direction:column;align-items:flex-start;gap:10px}
      .card{grid-template-columns:56px 1fr}
    }

    footer{text-align:center;color:var(--muted);font-size:13px;margin-top:20px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Tech data</h1>
        <div class="sub">Tech summary </div>
      </div>

      <div class="search-wrap" role="search" aria-label="Search Anything">
        <input id="searchInput" class="search-input" placeholder="Search Anything (e.g. Elon Musk, Taj Mahal) ‚Äî press Enter" />
        <button id="searchBtn" class="search-btn">Search</button>
      </div>
    </header>

    <main>
      <section id="feed" class="feed" aria-live="polite"></section>
      <div id="sentinel" style="height:40px"></div>
      <div id="loadingBox" class="center" style="margin-top:12px;display:none">
        <div style="width:120px;height:36px;border-radius:999px;border:1px solid rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center">Loading‚Ä¶</div>
      </div>
      <div id="errorBox" style="margin-top:12px;display:none"></div>
    </main>

    <footer>You cannot message anyone here..</footer>
  </div>

  <script>
    /* ---------- Config ---------- */
    const API_BASE = 'https://randomuser.me/api/';
    const PER_BATCH = 6;
    const seed = Math.floor(Math.random()*999999);
    const feed = document.getElementById('feed');
    const sentinel = document.getElementById('sentinel');
    const loadingBox = document.getElementById('loadingBox');
    const errorBox = document.getElementById('errorBox');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');

    let page = 1, loading = false, finished = false;
    const MAX_POSTS = 60;

    // Small helper
    function el(tag, cls=''){ const e=document.createElement(tag); if(cls) e.className=cls; return e; }
    function escapeHtml(s){ return String(s).replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
    function capitalize(s){ return s ? s.charAt(0).toUpperCase()+s.slice(1) : s; }
    function timeAgoRandom(){ const m=Math.floor(Math.random()*60*24*3); if(m<60) return m+'m'; const h=Math.floor(m/60); if(h<24) return h+'h'; return Math.floor(h/24)+'d'; }
    function chooseLorem(){ const lines=[ "Life's short ‚Äî scroll smart.", "Chasing sunsets and Wi-Fi signals.", "Coffee, code, repeat.", "Throwback to simpler pixels.", "If the algorithm served feelings, I'd be full.", "Said yes to new ideas today.", "Making mistakes so the future has material.", "Today I learned something tiny and useful." ]; const n=1+Math.floor(Math.random()*2); const out=[]; for(let i=0;i<n;i++) out.push(lines[Math.floor(Math.random()*lines.length)]); return out.join(' '); }

    /* ---------- Follow logic (localStorage) ---------- */
    function followingList(){ try{ return JSON.parse(localStorage.getItem('echo_follow')||'[]') }catch(e){ return [] } }
    function isFollowing(id){ return followingList().indexOf(id) !== -1 }
    function toggleFollow(btn,id){ let list = followingList(); if(isFollowing(id)){ list = list.filter(x=>x!==id); localStorage.setItem('echo_follow', JSON.stringify(list)); btn.classList.remove('following'); btn.textContent='Follow'; } else { list.push(id); localStorage.setItem('echo_follow', JSON.stringify(list)); btn.classList.add('following'); btn.textContent='Following'; } }

    /* ---------- Build post from randomuser ---------- */
    function buildRandomPost(user){
      const id = user.login.uuid;
      const name = capitalize(user.name.first) + ' ' + capitalize(user.name.last);
      const handle = '@' + (user.login.username || (user.name.first+user.name.last)).toLowerCase();
      const avatar = user.picture.large;
      const time = timeAgoRandom();
      const content = chooseLorem();
      const postImg = 'https://picsum.photos/seed/' + encodeURIComponent(user.login.uuid) + '/1200/800';

      const card = el('article','card');
      const av = el('div','avatar'); av.innerHTML = '<img loading="lazy" decoding="async" src="'+avatar+'" alt="'+escapeHtml(name)+'">';
      card.appendChild(av);

      const meta = el('div','meta');
      const row = el('div','meta-row');
      const left = el('div'); left.innerHTML = '<div class="name">'+escapeHtml(name)+'</div><div class="handle">'+escapeHtml(handle)+' ‚Ä¢ <span class="time">'+time+'</span></div>';
      row.appendChild(left);
      const right = el('div'); right.innerHTML = '<div class="btn badge-wiki">Random</div>';
      row.appendChild(right);
      meta.appendChild(row);

      const contentEl = el('div','content'); contentEl.textContent = content;
      meta.appendChild(contentEl);

      const imgWrap = el('div','post-image'); const image = el('img'); image.loading='lazy'; image.decoding='async'; image.src = postImg; imgWrap.appendChild(image); meta.appendChild(imgWrap);

      const actions = el('div','actions');
      const leftActions = el('div','left-actions'); leftActions.innerHTML = '‚ù§Ô∏è <span>'+(Math.floor(Math.random()*900)+10)+'</span> &nbsp; üí¨ <span>'+(Math.floor(Math.random()*300))+'</span> &nbsp; üîÅ <span>'+(Math.floor(Math.random()*150))+'</span>';
      const followBtn = el('button','btn'); followBtn.textContent='Follow'; followBtn.dataset.user=id;
      if(isFollowing(id)){ followBtn.classList.add('following'); followBtn.textContent='Following'; }
      followBtn.addEventListener('click', ()=> toggleFollow(followBtn, id));
      actions.appendChild(leftActions); actions.appendChild(followBtn);
      meta.appendChild(actions);

      card.appendChild(meta);
      return card;
    }

    /* ---------- Build Wikipedia post (search result) ---------- */
    function buildWikiPost(title, extract, imageUrl, pageUrl){
      const id = 'wiki-' + Math.random().toString(36).slice(2,9);
      const name = title;
      const handle = '@wikipedia';
      const avatar = 'https://upload.wikimedia.org/wikipedia/commons/6/63/Wikipedia-logo.png'; // small wiki logo
      const time = 'now';
      const content = extract || ('Summary not available for ' + title);
      const postImg = imageUrl || ('https://picsum.photos/seed/wiki-'+encodeURIComponent(title)+'/1200/800');

      const card = el('article','card');
      const av = el('div','avatar'); av.innerHTML = '<img loading="lazy" decoding="async" src="'+avatar+'" alt="Wikipedia">';
      card.appendChild(av);

      const meta = el('div','meta');
      const row = el('div','meta-row');
      const left = el('div'); left.innerHTML = '<div class="name">'+escapeHtml(name)+'</div><div class="handle">'+escapeHtml(handle)+' ‚Ä¢ <span class="time">'+time+'</span></div>';
      row.appendChild(left);
      const right = el('div'); right.innerHTML = '<div class="btn badge-wiki">Wikipedia</div>';
      row.appendChild(right);
      meta.appendChild(row);

      const contentEl = el('div','content');
      // link the title to the wikipedia page
      const short = document.createElement('div');
      short.innerHTML = escapeHtml(content) + ' <a href="'+escapeHtml(pageUrl)+'" target="_blank" rel="noopener" style="color:var(--accent);font-weight:700;text-decoration:none">Read more</a>';
      contentEl.appendChild(short);
      meta.appendChild(contentEl);

      const imgWrap = el('div','post-image'); const image = el('img'); image.loading='lazy'; image.decoding='async'; image.src = postImg; imgWrap.appendChild(image); meta.appendChild(imgWrap);

      const actions = el('div','actions');
      const leftActions = el('div','left-actions'); leftActions.innerHTML = 'üåê <span>Source: Wikipedia</span>';
      const followBtn = el('button','btn'); followBtn.textContent='Save'; followBtn.addEventListener('click', ()=> { alert('Saved to your bookmarks (demo)'); });
      actions.appendChild(leftActions); actions.appendChild(followBtn);
      meta.appendChild(actions);

      card.appendChild(meta);
      return card;
    }

    /* ---------- Fetch randomuser batch ---------- */
    async function fetchBatch(){
      if(loading || finished) return;
      loading = true; showLoading(true); showError(null);
      try{
        const url = API_BASE + '?results=' + PER_BATCH + '&page=' + page + '&seed=' + seed;
        const res = await fetch(url);
        if(!res.ok) throw new Error('API error ' + res.status);
        const json = await res.json();
        if(!json.results || !json.results.length){ finished = true; showLoading(false); return; }
        for(const user of json.results){
          const card = buildRandomPost(user);
          feed.appendChild(card);
        }
        page++;
      } catch(err){
        console.error(err);
        showError('Failed to load posts ‚Äî ' + (err.message || 'Network error'));
      } finally {
        loading = false; showLoading(false); prunePosts();
      }
    }

    function showLoading(show){ loadingBox.style.display = show ? 'flex' : 'none'; }
    function showError(msg){
      if(!msg){ errorBox.style.display='none'; errorBox.innerHTML=''; return; }
      errorBox.style.display='block'; errorBox.className='error';
      errorBox.innerHTML = '<div style="display:flex;align-items:center;justify-content:space-between;gap:12px"><div>'+escapeHtml(msg)+'</div><div><button id="retryBtn" class="btn">Retry</button></div></div>';
      document.getElementById('retryBtn').addEventListener('click', ()=> { showError(null); fetchBatch(); });
    }

    // show skeleton placeholders
    function showSkeletons(n=3){
      for(let i=0;i<n;i++){
        const sk = el('div','card');
        sk.innerHTML = '<div class="sk-row"><div class="sk-avatar skeleton"></div><div class="sk-lines"><div class="sk-line skeleton" style="width:60%"></div><div class="sk-line skeleton" style="width:40%"></div><div class="sk-line skeleton sk-large"></div></div></div>';
        feed.appendChild(sk);
      }
    }
    function clearSkeletons(){ const nodes = Array.from(feed.children); nodes.slice(0,3).forEach(n=>n.remove()); }

    // keep DOM light
    function prunePosts(){
      const children = feed.children;
      if(children.length > MAX_POSTS){
        const removeCount = children.length - MAX_POSTS;
        for(let i=0;i<removeCount;i++) feed.removeChild(children[children.length-1]); // remove oldest at bottom
      }
    }

    /* ---------- IntersectionObserver for infinite scroll ---------- */
    const io = new IntersectionObserver(entries => {
      for(const ent of entries) if(ent.isIntersecting) fetchBatch();
    }, {rootMargin: '300px'});
    io.observe(sentinel);

    // initial
    showSkeletons(3);
    fetchBatch().then(()=> clearSkeletons());

    /* ---------- Wikipedia search ---------- */
    async function searchWikipedia(q){
      if(!q || !q.trim()) return;
      const query = q.trim();
      showLoading(true); showError(null);
      try{
        // 1) Hit the REST summary endpoint for a concise extract + thumbnail
        const summaryUrl = 'https://en.wikipedia.org/api/rest_v1/page/summary/' + encodeURIComponent(query);
        const res = await fetch(summaryUrl);
        if(res.status === 404){
          showError('No Wikipedia article found for "'+query+'". Try different keywords.');
          return;
        }
        if(!res.ok) throw new Error('Wikipedia error ' + res.status);
        const data = await res.json();
        // data.title, data.extract (summary), data.content_urls.desktop.page, data.thumbnail.source (maybe)
        const title = data.title || query;
        const extract = data.extract || '';
        const pageUrl = (data.content_urls && data.content_urls.desktop && data.content_urls.desktop.page) ? data.content_urls.desktop.page : ('https://en.wikipedia.org/wiki/' + encodeURIComponent(title));
        const imageUrl = (data.thumbnail && data.thumbnail.source) ? data.thumbnail.source : null;

        // Build a wiki post and insert at top of feed
        const wikiCard = buildWikiPost(title, extract, imageUrl, pageUrl);
        feed.insertBefore(wikiCard, feed.firstChild);
        // scroll to top so user sees it
        window.scrollTo({ top: 0, behavior: 'smooth' });

      } catch(err){
        console.error(err);
        showError('Wikipedia fetch failed ‚Äî ' + (err.message || 'Network error'));
      } finally {
        showLoading(false);
      }
    }

    // Hook up Enter key and button
    searchInput.addEventListener('keydown', (e)=> { if(e.key === 'Enter') doSearch(); });
    searchBtn.addEventListener('click', doSearch);
    function doSearch(){ const q = searchInput.value; if(!q || !q.trim()) { searchInput.focus(); return; } searchWikipedia(q); }

    // Optional: accept "I'm feeling lucky" auto-mix (not requested now)
    // End of script

    // Cleanup on page hide
    window.addEventListener('beforeunload', ()=> { io.disconnect(); });

  </script>
</body>
  </html>
